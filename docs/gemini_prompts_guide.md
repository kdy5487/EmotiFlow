# Gemini API 프롬프트 가이드

EmotiFlow 앱에서 사용하는 Google Gemini API 프롬프트들의 구조와 목적을 설명합니다.

## 🔄 최근 변경사항 (2024년 12월)

### 주요 개선사항
- **감정 선택 제한**: AI 대화 시 감정을 하나만 선택하도록 변경
- **프롬프트 간소화**: 초기 질문과 대화 프롬프트를 더 간결하게 개선
- **반복 방지**: AI가 비슷한 말을 반복하지 않도록 프롬프트 강화
- **응답 길이 최적화**: AI 응답을 3-4문장으로 제한하여 가독성 향상
- **자연스러운 대화**: 어색한 표현과 반복적인 내용 제거

## 📋 목차

1. [감정 선택 안내 프롬프트](#감정-선택-안내-프롬프트)
2. [감정 기반 질문 생성 프롬프트](#감정-기반-질문-생성-프롬프트)
3. [감정 분석 및 위로 프롬프트](#감정-분석-및-위로-프롬프트)
4. [일기 요약 생성 프롬프트](#일기-요약-생성-프롬프트)
5. [AI 이미지 생성 프롬프트](#ai-이미지-생성-프롬프트)
6. [프롬프트 최적화 팁](#프롬프트-최적화-팁)

## 🎯 감정 선택 안내 프롬프트

### 목적
사용자가 일기 작성을 시작할 때 자연스럽고 편안한 대화 시작을 유도

### 프롬프트 구조 (2024년 12월 개선)
```
당신은 따뜻하고 공감적인 AI 상담사입니다.

사용자가 일기를 작성하려고 합니다. 감정을 선택하거나 자유롭게 이야기할 수 있다고 간단하게 안내해주세요.

**응답 스타일:**
- 2-3문장으로 간결하게 작성
- 친근하고 따뜻한 톤
- 감정 선택과 자유로운 대화 모두 가능함을 간단히 안내

**주의사항:**
- 마크다운 표시나 과도한 이모지 사용하지 말기
- 사용자가 편안하게 이야기할 수 있도록 안내

한국어로 친근하고 따뜻한 톤으로 답변해주세요.
```

### 실제 적용 예시
- "안녕하세요! 오늘은 어떤 이야기를 나눠볼까요? 일기 쓰는 게 망설여진다면, 기쁨, 슬픔, 화남, 평온, 설렘, 피곤함, 놀람, 걱정 중에서 선택해보세요."

## 💭 감정 기반 질문 생성 프롬프트

### 목적
사용자가 선택한 감정을 바탕으로 맞춤형 질문을 생성하여 자연스러운 대화 유도

### 프롬프트 구조 (2024년 12월 개선)
```
당신은 따뜻한 AI 상담사입니다.

사용자 응답: {사용자_메시지}
대화 히스토리: {대화_내역}

**지속적 대화 상황입니다. 이전 대화를 참고하여 맞춤형으로 응답해주세요:**

- 이전 대화 내용을 참고하여 자연스럽게 연결
- 사용자의 감정 변화나 패턴을 고려하여 적절한 위로나 격려 제공
- 반복적인 내용이나 비슷한 말을 하지 않기

**응답 스타일:**
- 공감과 위로를 자연스럽게 하나로 통합
- 3-4문장으로 간결하게 작성
- 사용자의 이야기에 대한 진심 어린 공감
- **후속 질문은 반드시 1개만** (여러 개 질문하지 말기)
- 친근하고 따뜻한 톤

**주의사항:**
- 마크다운 표시나 과도한 이모지 사용하지 말기
- **비슷한 내용의 반복적인 답변 절대 금지**
- 자연스럽게 하나의 흐름으로 연결
- **"힘내세요", "화이팅" 같은 마무리 표현 사용하지 말기**
- 대신 "더 이야기해주세요", "계속 들려주세요" 같은 표현으로 대화 계속 유도
```

### 감정별 질문 예시
- **기쁨**: "오늘 기분이 좋으시군요! 어떤 특별한 일이 있었나요?"
- **슬픔**: "힘든 하루를 보내셨나요? 무엇이 마음을 무겁게 했는지 들어보고 싶어요."
- **화남**: "화가 나는 일이 있으셨나요? 그 상황에 대해 더 이야기해주세요."

## 🔄 감정 선택 제한 변경사항

### 변경 전후 비교
- **변경 전**: AI 대화 시 감정을 최대 2개까지 선택 가능
- **변경 후**: AI 대화 시 감정을 하나만 선택하도록 제한

### 변경 이유
- **사용자 경험 개선**: 감정 선택이 너무 복잡하지 않도록 단순화
- **AI 응답 일관성**: 하나의 감정에 집중하여 더 맞춤형 대화 제공
- **UI 단순화**: 감정 선택 UI를 더 직관적이고 사용하기 쉽게 개선

### 코드 변경사항
```dart
// 변경 전
List<String> _selectedEmotions = []; // 최대 2개

// 변경 후  
String? _selectedEmotion; // 하나만
```

## 🤗 감정 분석 및 위로 프롬프트

### 목적
사용자의 감정을 분석하고 공감과 위로를 제공하며 실용적인 조언 제시

### 프롬프트 구조
```
사용자와의 대화 내용: {대화_전체}
선택된 감정: {감정}

다음 내용을 자연스럽게 통합하여 응답해줘:

1. **감정 인정과 공감**
   - 사용자의 감정을 있는 그대로 인정
   - "그럴 수 있어요", "충분히 이해해요" 등의 공감 표현

2. **따뜻한 위로**
   - 사용자의 상황에 맞는 따뜻한 위로
   - 감정의 정당성 인정

3. **실용적 조언**
   - 구체적이고 실행 가능한 1-2가지 조언
   - 사용자의 상황에 맞는 맞춤형 해결책

**응답 스타일:**
- 분석, 공감, 위로, 조언을 자연스럽게 하나로 통합
- 5-6문장을 넘지 않도록 간결하게
- 1-2가지 실용적인 팁 제공
- 계속 대화할 수 있도록 격려

**주의사항:**
- 각 섹션을 명확히 구분하지 말고 자연스럽게 연결
- 비슷한 내용의 반복적인 답변 피하기
- "힘내세요" 같은 마무리보다는 지속적인 대화 유도
```

## 📝 일기 요약 생성 프롬프트

### 목적
대화 내용을 바탕으로 자연스러운 일기 형태로 정리하고 마무리 메시지 생성

### 프롬프트 구조
```
사용자와의 대화 내용: {대화_내역}
선택된 감정: {감정}

**응답 구성:**
제목, 내용, 마무리를 자연스럽게 하나로 통합하여 일기 형태로 작성

1. **제목 요소**
   - 오늘의 주요 사건이나 감정을 담은 제목

2. **내용 요소**
   - 대화 내용을 바탕으로 한 자연스러운 일기 본문
   - 사용자의 감정과 경험을 중심으로 하루 정리

3. **마무리 요소**
   - 오늘 하루에 대한 소감
   - 내일에 대한 생각이나 다짐

**AI 이미지 생성 제안:**
마지막에 다음 중 하나의 표현 포함:
- "AI가 오늘의 감정과 경험을 바탕으로 그림을 그려드릴까요?"
- "AI가 이 대화 내용을 바탕으로 그림을 생성해드릴 수 있어요"

**응답 스타일:**
- 6-7문장을 넘지 않도록 간결하게
- 각 섹션을 구분하지 말고 자연스럽게 연결
- 마크다운 표시나 과도한 이모지 사용하지 말기

**주의사항:**
- 각 섹션을 명확히 구분하지 말고 자연스럽게 연결
- 자연스럽고 따뜻한 톤으로 작성
```

## 🎨 AI 이미지 생성 프롬프트

### 목적
사용자의 대화 내용과 감정을 바탕으로 맞춤형 이미지 생성을 위한 상세 프롬프트 작성

### 프롬프트 구조 (실제 구현)
```
다음 내용을 바탕으로 감정적이고 아름다운 일기 그림을 그려주세요:

감정: {선택된_감정}
일기 내용: {일기_요약}
핵심 키워드: {추출된_키워드}

**스타일 가이드:**
- 감정에 맞는 색감과 분위기
- 일기 내용을 상징적으로 표현
- 따뜻하고 아름다운 일러스트레이션
- 한국적인 감성과 현대적인 디자인

이 그림은 사용자의 개인적인 감정과 경험을 표현하는 일기용 이미지입니다.
```

### 엔드포인트/파라미터 (구현 기준)
- 모델: `gemini-1.5-flash:generateContent`
- 요청 바디: `contents.parts[].text`에 프롬프트 전달
- generationConfig: `temperature: 0.8`, `maxOutputTokens: 2048`
- 반환 처리: 첫 candidate → content.parts[0].text 추출(텍스트 URL 가정) → `Image.network` 미리보기
- 실패 처리: null 반환 → 다이얼로그/스낵바 안내

### 키워드 추출 로직
```javascript
// 감정 관련 키워드
if (message.contains('기쁨') || message.contains('행복') || message.contains('즐거')) 
    keywords.add('기쁨');

// 활동 관련 키워드  
if (message.contains('산책') || message.contains('걷기')) 
    keywords.add('산책');
if (message.contains('음식') || message.contains('밥') || message.contains('먹')) 
    keywords.add('음식');
if (message.contains('친구') || message.contains('사람') || message.contains('만남')) 
    keywords.add('사람');
```

## 💡 프롬프트 최적화 팁

### 1. 응답 길이 제어
- **질문**: 1-2문장으로 간결하게
- **위로/조언**: 2-3문장으로 충분한 내용 제공
- **요약**: 6-7문장 이내로 제한

### 2. 자연스러운 대화 흐름
- 각 섹션을 명확히 구분하지 말고 자연스럽게 연결
- 마크다운(`**`, `##`) 사용 금지
- 과도한 이모지 사용 금지

### 3. 사용자 맞춤화
- 대화 기록을 활용한 개인화된 응답
- 사용자의 감정 상태에 따른 적절한 톤 조절
- 이전 대화와의 연결성 유지

### 4. 한국어 특성 고려
- 존댓말 사용으로 정중하고 따뜻한 느낌
- 한국 문화에 맞는 표현과 예시 사용
- 감정 표현의 미묘한 차이 반영

### 5. API 파라미터 최적화
```javascript
generationConfig: {
  temperature: 0.8,        // 창의성과 일관성의 균형
  topK: 40,               // 응답의 다양성 제어
  topP: 0.95,             // 높은 품질의 응답 보장
  maxOutputTokens: 2048,  // 충분한 응답 길이 확보
}
```

## 🔄 프롬프트 버전 관리

### 현재 버전: v2.2 (2025-01-)
- 감정 선택 UI 재도입
- 동적 대화 시작 로직 개선
- AI 이미지 생성 프롬프트 추가
- 응답 길이 최적화
- Gemini 1.5 Flash 엔드포인트 명시 및 파라미터 고정

### 이전 버전 변경사항
- v2.0: 자유형 대화 중심으로 전환
- v1.5: 감정 기반 질문 시스템 도입
- v1.0: 기본 OpenAI 프롬프트 구조

## 📊 성능 모니터링

### 주요 지표
- **응답 시간**: 평균 2-3초 이내
- **응답 품질**: 사용자 만족도 기반
- **API 사용량**: 월 1000회 제한 내 관리
- **오류율**: 5% 이하 유지

### 개선 포인트
- 프롬프트 길이와 응답 품질의 균형
- 한국어 자연스러움 지속적 개선
- 사용자 피드백 반영한 프롬프트 업데이트
