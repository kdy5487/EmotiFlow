# 개발 일지 - 2026-01-21

## ✅ 완료된 기능

### 1. AI 채팅 UI 전면 개편 (감정 캐릭터 시스템)

**작업 내용:**
- 감정-캐릭터 매핑 시스템 구현 (`EmotionCharacterMap`)
- AI 메시지 버블에 캐릭터 이미지 표시 (48px 원형)
- 캐릭터 기반 감정 선택 UI (4열 그리드 레이아웃)
- 감정별 배경색 자동 변경 (파스텔 톤)
- 말풍선 디자인 모던화 (카카오톡 스타일)
- 타이핑 인디케이터 캐릭터 통합
- 헤더에 캐릭터 미니 아이콘 추가

**수정/추가 파일:**
```
✨ 신규: lib/shared/constants/emotion_character_map.dart
🔧 수정: lib/features/diary/views/diary_chat_write_page/
  - diary_chat_write_page.dart
  - widgets/chat_message_bubble.dart
  - widgets/chat_emotion_selector.dart
  - widgets/typing_indicator.dart
📝 문서: docs/EMOTI_FLOW_DEVELOPMENT_PLAN.md
📝 문서: docs/EMOTI_FLOW_UI_UX_PLAN.md
```

**커밋 메시지 (복사용):**
```
feat: AI 채팅 UI 전면 개편 - 감정 캐릭터 시스템 통합

- EmotionCharacterMap 클래스 추가 (10가지 감정 매핑)
- AI 메시지 버블에 캐릭터 이미지 표시
- 캐릭터 기반 감정 선택 UI (4열 그리드)
- 감정별 배경색 자동 변경
- 말풍선 디자인 모던화
- 타이핑 인디케이터 캐릭터 통합
```

**테스트 사항:**
- [ ] 10가지 감정 각각 선택 테스트
- [ ] 캐릭터 이미지 로딩 확인
- [ ] 배경색 변경 확인
- [ ] 이미지 로드 실패 시 fallback 확인

---

---

### 2. AI 채팅 UI/UX 개선 (사용자 피드백 반영)

**작업 내용:**
- 앱바 타이틀 간소화 (캐릭터 아이콘만 표시)
- 키보드 외부 터치 시 자동 닫기 (전역 적용)
  - `KeyboardDismissibleScaffold` 공통 위젯 생성
- 감정 선택 UI 오버플로우 수정
  - maxHeight 제한 + SingleChildScrollView
  - 연한 크림색 배경 (#FFFDF7)
- 감정 선택 페이지 추가 (AI 대화 진입 전)
  - "선택 안함" 옵션 추가 (대표 캐릭터)
  - 선택 후 채팅방으로 자동 전환
- 감정 선택 UI 지연 개선
  - Fallback 메시지 즉시 표시
  - Gemini API 비동기 호출로 변경
  - 성능 로그 추가 (원인 분석용)
- 앱 로고 잘림 문제 수정 (pubspec.yaml)

**수정/추가 파일:**
```
✨ 신규: lib/shared/widgets/keyboard_dismissible_scaffold.dart
✨ 신규: lib/features/diary/views/emotion_selection_page/emotion_selection_page.dart
🔧 수정: lib/features/diary/views/diary_chat_write_page/
  - diary_chat_write_page.dart
  - widgets/chat_emotion_selector.dart
🔧 수정: pubspec.yaml
```

**커밋 메시지 (복사용):**
```
fix: AI 채팅 UI/UX 개선 - 사용자 피드백 반영

- 앱바 타이틀 간소화 (캐릭터만 표시)
- 키보드 외부 터치 시 자동 닫기 (전역 적용)
- 감정 선택 UI 오버플로우 수정
- 감정 선택 페이지 추가 (진입점 개선)
- 감정 선택 UI 지연 개선 (Fallback 즉시 표시)
- 앱 로고 잘림 문제 수정
```

**성능 개선 결과:**
- Before: 감정 선택 UI 표시까지 2-3초 (Gemini API 대기)
- After: 즉시 표시 (<100ms) + API 응답 비동기 처리

**테스트 사항:**
- [x] 키보드 외부 터치로 닫기 확인
- [x] 감정 선택 UI 오버플로우 없음
- [x] 감정 선택 페이지 → 채팅방 전환
- [x] "선택 안함" 옵션 동작 확인
- [ ] 앱 로고 확인 (재빌드 후)

---

### 3. 사용자 피드백 추가 반영 + 테스트 코드 작성

**작업 내용:**
- 채팅 메시지 폰트 사이즈 축소 (15px → 14px)
- 라우터 진입점 변경 (`/diaries/chat` → EmotionSelectionPage 먼저 표시)
- DiaryChatWritePage에서 ChatEmotionSelector 위젯 제거 (미사용 코드)
- `_selectEmotion` 메서드 제거 (감정 선택 페이지로 이동)
- `_emotionSelected` 플래그 제거 (불필요)
- 테스트 코드 작성:
  - `test/shared/constants/emotion_character_map_test.dart` (단위 테스트)
  - `test/performance/emotion_selection_performance_test.dart` (성능 테스트)
- 트러블슈팅 문서에 성능 개선 내용 추가

**수정/추가 파일:**
```
✨ 신규: test/shared/constants/emotion_character_map_test.dart
✨ 신규: test/performance/emotion_selection_performance_test.dart
🔧 수정: lib/features/diary/views/diary_chat_write_page/
  - diary_chat_write_page.dart (ChatEmotionSelector 제거)
  - widgets/chat_message_bubble.dart (폰트 14px)
🔧 수정: lib/routes/app_router.dart (진입점 변경)
📝 수정: docs/troubleshooting.md (성능 개선 문서화)
```

**커밋 메시지 (복사용):**
```
refactor: 감정 선택 페이지 분리 + 테스트 코드 추가

- 채팅 메시지 폰트 사이즈 14px로 축소
- /diaries/chat → EmotionSelectionPage 진입점 변경
- DiaryChatWritePage에서 ChatEmotionSelector 제거
- 미사용 코드 정리 (_selectEmotion, _emotionSelected)
- EmotionCharacterMap 단위 테스트 작성
- 성능 테스트 코드 작성 (지연 원인 분석)
- 트러블슈팅 문서 업데이트 (성능 개선 내용)
```

**테스트 실행:**
```bash
# 단위 테스트
flutter test test/shared/constants/emotion_character_map_test.dart

# 성능 테스트
flutter test test/performance/emotion_selection_performance_test.dart
```

---

### 4. Navigator 에러 수정 + 감정 선택 UI 개선

**작업 내용:**
- Navigator 에러 수정 (`pushReplacement` → `push`)
  - GoRouter와 충돌하는 page-based navigation 에러 해결
- 대표 캐릭터 변경 (`Emoti3.png` → `Emoti.png`)
  - 배경이 있는 캐릭터로 변경
- 감정 선택 페이지 적응형 UI 적용
  - `LayoutBuilder` + `MediaQuery`로 화면 크기 대응
  - 모든 요소에 적응형 크기 적용 (캐릭터 이미지, 그리드 아이템, 텍스트)
- 그리드 레이아웃 변경 (4x3 → 3x4)
  - `crossAxisCount: 4` → `3`으로 변경
  - 3열 4행으로 더 여유있는 레이아웃
- 오버플로우 해결
  - `Flexible` 위젯으로 텍스트 영역 처리
  - `constraints` 추가로 최소/최대 크기 보장

**수정 파일:**
```
🔧 수정: lib/features/diary/views/emotion_selection_page/emotion_selection_page.dart
🔧 수정: lib/shared/constants/emotion_character_map.dart
```

**커밋 메시지 (복사용):**
```
fix: 감정 선택 페이지 Navigator 에러 및 UI 개선

- Navigator 에러 수정 (pushReplacement → push)
- 대표 캐릭터 Emoti.png로 변경
- 적응형 UI 전면 적용 (LayoutBuilder + MediaQuery)
- 그리드 레이아웃 3x4로 변경 (4x3 → 3x4)
- 오버플로우 해결 (Flexible + constraints)
- 모든 요소 화면 크기에 맞게 반응형 처리

Fixes: page-based route Navigator assertion error
```

---

### 5. 감정 선택 UI 개선 + AI 입력 검증 로직 추가

**작업 내용:**
- 감정 캐릭터 잘림 방지
  - `BoxShape.circle` → `BorderRadius.circular(16)` (둥근 사각형)
  - `Padding` 추가하여 캐릭터 이미지 여백 확보
  - `BoxFit.cover` → `BoxFit.contain`으로 변경
  - 배경은 잘려도 캐릭터는 온전하게 표시
- 선택 모션 개선
  - 보라색 배경 원 제거
  - 대신 border 강조 (1.5px → 3px)
  - 그림자 효과 강화 (blurRadius: 16, spreadRadius: 3)
  - `AnimatedContainer`로 부드러운 전환 효과
  - `AnimatedDefaultTextStyle`로 텍스트 색상 애니메이션
  - 글자 색상 변경은 유지 (보라색 → 주 색상)
- AI 입력 검증 로직 추가
  - 의미 없는 답변 감지 (`_isInvalidUserResponse`)
    - 너무 짧은 답변 (1-2글자)
    - 의미 없는 문자 반복 (ㅋㅋㅋㅋ, ....)
    - 랜덤 키 입력 (asdf, qwer 등)
    - 대부분 특수문자
    - 숫자만 입력
  - 이해 불가 시 다시 물어보기 (`_getInvalidResponseMessage`)
    - 4가지 다양한 응답 메시지
    - 무조건 공감하는 대신 구체적으로 다시 질문

**수정 파일:**
```
🔧 수정: lib/features/diary/views/emotion_selection_page/emotion_selection_page.dart
🔧 수정: lib/core/ai/gemini/gemini_service.dart
```

**커밋 메시지 (복사용):**
```
feat: 감정 선택 UI 개선 및 AI 입력 검증 추가

UI 개선:
- 감정 캐릭터 잘림 방지 (둥근 사각형 + 패딩)
- 선택 모션 개선 (border 강조 + 그림자 효과)
- AnimatedContainer로 부드러운 전환
- BoxFit.contain으로 캐릭터 온전히 표시

AI 개선:
- 의미 없는 답변 감지 로직 추가
- 이해 불가 시 다시 질문하는 응답
- 무조건 공감 대신 스마트한 대화

Fixes: 캐릭터 이미지 잘림, 과도한 AI 공감
```

---

### 6. 감정 선택 UI 최종 개선 (빈 공간 제거)

**작업 내용:**
- 미사용 파일 정리 확인
  - `emoti.png`, `Emoti 1.png` 이미 삭제됨
  - 현재 사용: `Emoti2.png` (대표), `Emoti3.png`, `Emoti_name.png`
- 감정 선택 UI 빈 공간 제거
  - 패딩: `10px → 4px` (대표 캐릭터)
  - 패딩: `6px → 2px` (감정 아이템)
  - 이미지가 박스를 거의 채우도록 개선
- 선택 효과 강화
  - 미선택 시: border 투명 (완전히 제거)
  - 선택 시: border 3.5px + 강한 그림자
  - BorderRadius 20px로 더 부드럽게
  - 그림자 효과 강화 (blurRadius: 20, spreadRadius: 4)

**수정 파일:**
```
🔧 수정: lib/features/diary/views/emotion_selection_page/emotion_selection_page.dart
```

**커밋 메시지 (복사용):**
```
refactor: 감정 선택 UI 빈 공간 제거 및 선택 효과 개선

- 패딩 최소화 (10px→4px, 6px→2px)
- 이미지가 박스를 거의 채우도록 개선
- 미선택 시 border 완전 제거 (투명)
- 선택 시 border 3.5px + 강한 그림자
- BorderRadius 20px로 더 부드럽게
- 대표 캐릭터 Emoti2.png 적용

Fixes: 감정 선택 UI 빈 공간 어색함
```

---

### 7. 감정 선택 UI 최종 완성 (통일된 크기 + 간격 조정)

**작업 내용:**
- 캐릭터 이미지 크기 통일
  - 모든 이미지를 고정 크기 75x75로 통일
  - 제일 큰 이미지 기준으로 설정
  - `itemSize` 계산 제거, 고정 크기 사용
- 바깥 사각형과 이미지 동일 형태
  - Container와 Image 모두 75x75
  - padding 완전 제거
  - `BoxFit.cover`로 박스를 완전히 채움
  - BorderRadius 20px로 동일하게 적용
- 그리드 간격 최적화
  - 가로 간격: `screenWidth * 0.03` → `12px` (고정)
  - 세로 간격: `screenHeight * 0.015` → `10px` (줄임)
  - childAspectRatio: `0.85` → `0.95` (더 컴팩트)
- 텍스트 크기 고정
  - `screenWidth * 0.03` → `11px` (고정)

**수정 파일:**
```
🔧 수정: lib/features/diary/views/emotion_selection_page/emotion_selection_page.dart
```

**커밋 메시지 (복사용):**
```
refactor: 감정 선택 UI 크기 통일 및 간격 최적화

- 모든 캐릭터 이미지 75x75 고정 크기
- 바깥 사각형과 이미지 크기 완전 동일
- padding 완전 제거 (이미지가 박스를 채움)
- BoxFit.cover로 빈 공간 제거
- 세로 간격 줄임 (15px→10px)
- 가로 간격 고정 (12px)
- childAspectRatio 0.95로 더 컴팩트하게

Fixes: 이미지 크기 불일치, 세로 간격 과다
```

---

### 8. 감정 선택 UI 완성도 개선 (공백 제거)

**작업 내용:**
- 대표 캐릭터 바깥 박스 제거
  - 흰색 Container 완전 제거
  - 이미지만 둥글게 표시 (ClipRRect)
  - 크기 증가 (0.25 → 0.3)
  - BoxFit.cover로 완전히 채움
- 선택 시 테두리 둥근 정도 완벽 일치
  - 미선택: borderRadius 20
  - 선택: 
    - 바깥 border: borderRadius 20
    - 안쪽 padding: 3.5px
    - 이미지 borderRadius: 16.5 (20 - 3.5)
  - 흰색 공백 완전 제거
  - 배경 투명으로 설정

**수정 파일:**
```
🔧 수정: lib/features/diary/views/emotion_selection_page/emotion_selection_page.dart
```

**커밋 메시지 (복사용):**
```
fix: 감정 선택 UI 흰색 공백 완전 제거

- 대표 캐릭터 바깥 박스 제거 (이미지만 표시)
- 선택 시 테두리 둥근 정도 완벽 일치
- 배경 투명으로 설정
- padding으로 border width만큼 안쪽 처리
- 이미지 borderRadius 동적 계산 (20 - 3.5 = 16.5)
- 흰색 공백 완전 제거

Fixes: 선택 시 흰색 공백 표시, 대표 캐릭터 불필요한 박스
```

---

### 9. AI 입력 검증 로직 강화 (오타 및 의미 없는 입력 감지)

**작업 내용:**
- 같은 문자 반복 감지 강화
  - 2번 이상 반복 + 5글자 이하 → 무효 (예: "fff", "kkk")
  - 4번 이상 반복 → 무조건 무효 (예: "aaaa")
- 영문자 패턴 검증 추가
  - 영문 3-5글자 중 모음 없으면 무효 (예: "fff", "ddd")
  - 의미 있는 영단어 예외 처리 (yes, no, ok, good, bad, help)
  - "fff", "ddd", "sss" 등 패턴 추가
- 한글 자음/모음만 있는 경우 감지
  - "ㅋㅋㅋ", "ㅠㅠ" 등 완벽하게 차단
- 문자 비율 검증
  - 같은 문자가 80% 이상 → 무효 (예: "ggggg")

**수정 파일:**
```
🔧 수정: lib/core/ai/gemini/gemini_service.dart
```

**커밋 메시지 (복사용):**
```
feat: AI 입력 검증 로직 대폭 강화

- 같은 문자 반복 감지 강화 (fff, kkk 등)
- 영문자 모음 유무 검사 추가
- 한글 자음/모음만 입력 차단
- 문자 비율 검증 (80% 이상 같은 문자)
- 의미 있는 영단어 예외 처리
- 8가지 검증 규칙으로 확장

Fixes: fff, kkk, ddd 등 오타를 설렘으로 잘못 해석
```

**테스트 케이스:**
```
Input: "fff"        → ❌ 무효 (같은 문자 3번 반복 + 모음 없음)
Input: "kkk"        → ❌ 무효 (같은 문자 3번 반복 + 모음 없음)
Input: "ddd"        → ❌ 무효 (같은 문자 3번 반복 + 모음 없음)
Input: "asdf"       → ❌ 무효 (랜덤 키 패턴)
Input: "ㅋㅋㅋ"     → ❌ 무효 (한글 자음만)
Input: "ㅠㅠㅠ"     → ❌ 무효 (한글 모음만)
Input: "ggggg"      → ❌ 무효 (80% 이상 같은 문자)
Input: "yes"        → ✅ 유효 (의미 있는 영단어)
Input: "good"       → ✅ 유효 (의미 있는 영단어)
Input: "오늘 힘들었어" → ✅ 유효 (정상 입력)
```

---

### 10. 자유일기 UI 전면 개편 (AI 채팅일기 분위기로)

**작업 내용:**
- 레이아웃 순서 개선
  - 날짜 선택 → 오늘의 감정 → 제목 → 일기 내용 → 그림 그리기 → 설정
- 오늘의 감정 선택 UI
  - 캐릭터 이미지 사용 (EmotionCharacterMap)
  - 4x3 그리드 (4열 3행)
  - 크기 줄임 (60x60px)
  - 선택 시 border + shadow 효과
- 전체 UI 분위기
  - AI 채팅일기와 동일한 배경색 (#FFFDF7)
  - 흰색 카드 형태의 섹션
  - 깔끔한 그림자 효과
  - KeyboardDismissibleScaffold 적용
- 날짜 선택 UI 개선
  - 카드 형태로 변경
  - 아이콘 + 텍스트 레이아웃
  - 한국어 날짜 포맷 (yyyy년 M월 d일 (E))
- 제목/내용 입력 UI
  - 카드 형태로 개선
  - 테두리 스타일 통일
  - Focus 시 primary 색상 border
- 그림 그리기 섹션
  - 카드 형태로 개선
  - 미리보기 + 삭제 기능
  - 버튼 스타일 통일
- 설정 섹션 간소화
  - SwitchListTile로 깔끔하게
  - 비공개 일기 / AI 분석 허용
- 적응형 UI 적용
  - MediaQuery로 화면 크기 대응
  - 패딩/간격 동적 조절

**수정 파일:**
```
🔧 수정: lib/features/diary/views/diary_write_page/diary_write_page.dart
```

**커밋 메시지 (복사용):**
```
feat: 자유일기 UI 전면 개편 (AI 채팅일기 스타일)

- 레이아웃 순서 개선 (날짜→감정→제목→내용→그림→설정)
- 오늘의 감정: 캐릭터 이미지 사용 (4x3)
- 전체 배경색 통일 (#FFFDF7)
- 카드 형태 섹션 디자인
- KeyboardDismissibleScaffold 적용
- 날짜 선택 UI 개선
- 제목/내용 입력 스타일 통일
- 그림 그리기 섹션 개선
- 설정 간소화 (SwitchListTile)
- 적응형 UI 적용

Improves: 자유일기 UI/UX 대폭 개선
```

**Bug Fix:**
- `intl` locale 초기화 에러 수정
  - `DateFormat('yyyy년 M월 d일 (E)', 'ko_KR')` 제거
  - 커스텀 `_formatDate()` 메서드로 대체
  - `Locale data has not been initialized` 에러 해결

**테스트 체크리스트:**
```
✅ 자유일기 작성 페이지 진입 (에러 없음)
✅ 날짜 선택 동작 확인
✅ 한국어 날짜 포맷 표시 (2026년 1월 21일 (화))
✅ 감정 캐릭터 이미지 표시 (4x3 그리드)
✅ 감정 최대 2개 선택 제한
✅ 감정 강도 슬라이더 동작
✅ 제목/내용 입력 정상 동작
✅ 그림 그리기 → 캔버스 → 미리보기
✅ 사진 추가 (선택 시 미리보기)
✅ 설정 옵션 토글 동작
✅ 일기 저장 정상 동작
✅ 키보드 외부 터치 시 자동 닫힘
✅ 다양한 화면 크기에서 오버플로우 없음
```

---

### 11. 자유일기 UI 세부 개선 (사용자 피드백 반영)

**작업 내용:**
- 감정 선택 그리드 오버플로우 수정
  - `LayoutBuilder`로 완전 적응형 UI 적용
  - `childAspectRatio` 동적 계산
  - `mainAxisSpacing` 증가 (10 → 18)
  - `Flexible` 위젯으로 텍스트 오버플로우 방지
- 감정 강도 슬라이더 개선
  - `SliderTheme`로 굵기 조정 (`trackHeight: 3.0`)
  - 썸/오버레이 크기 최적화
  - 하단 패딩 축소 (16 → 8)
- 설정 섹션에 "개발중" 배지 추가
  - 주황색 배지로 명확히 표시
- 저장 버튼 아이콘 제거
  - `Icons.save` 제거 (깔끔한 UI)
- 그림 그리기 패키지 평가 완료

**수정 파일:**
```
🔧 수정: lib/features/diary/views/diary_write_page/diary_write_page.dart
```

**커밋 메시지 (복사용):**
```
fix: 자유일기 UI 세부 개선

- 감정 선택 그리드 오버플로우 수정 (LayoutBuilder)
- 감정 강도 슬라이더 굵기 조정 (3.0px)
- 슬라이더 하단 공백 축소 (16 → 8)
- 설정 섹션 "개발중" 배지 추가
- 저장 버튼 아이콘 제거

Fixes: 오버플로우, 슬라이더 굵기, 설정 명시
```

**그림 그리기 패키지 평가:**

**✅ 현재 구현 기능 (양호):**
1. 기본 그리기 (펜/터치)
2. 색상 선택 (20가지 색상 팔레트)
3. 브러시 크기 (8단계: 2-24px)
4. 지우개 (브러시 크기 2배)
5. 실행 취소/다시 실행
6. 전체 지우기
7. PNG 내보내기 (고해상도 3.0x)

**⚠️ 개선 필요 사항:**
1. **레이어 시스템 부재** - 다층 그림 불가
2. **도형 도구 없음** - 원, 사각형, 선 등
3. **텍스트 입력 없음** - 감정 텍스트 추가 불가
4. **이미지 불러오기 없음** - 배경 이미지 불가
5. **스티커/이모지 없음** - 감정 표현 제한적
6. **필터/효과 없음** - 블러, 그림자 등
7. **확대/축소/이동 없음** - 세밀한 작업 어려움
8. **자동 저장 없음** - 실수로 닫으면 손실

**📊 종합 평가:**

**사용성:** ⭐⭐⭐☆☆ (3/5)
- 기본 그리기는 충분하지만 고급 기능 부족
- 일기용 간단한 낙서/스케치에는 적합
- 전문적인 그림에는 부족

**추천 사항:**
1. **현재 상태로 유지해도 OK** (간단한 감정 표현용)
2. **단기 개선안:**
   - 도형 도구 추가 (원, 하트, 별 등)
   - 감정 스티커 추가 (😊😢😡 등)
   - 자동 저장 기능
3. **장기 개선안:**
   - 외부 패키지 도입 (`flutter_painter`, `drawing_board`)
   - 레이어 시스템
   - 확대/축소/팬 제스처

**결론:**
✅ **현재 상태로 출시 가능** (MVP 단계)
⚠️ **추후 개선 권장** (사용자 피드백 수집 후)
```

---

### 12. 그림 그리기 패키지 대폭 개선 (단기 개선안 적용)

**작업 내용:**
- 감정 스티커 추가 (15개)
  - 😊😢😡😱😍🤗😴🤔😎🥳❤️💔⭐✨🌈
  - 탭으로 스티커 추가
  - 중앙 위치에 배치
- 도형 도구 추가 (3종)
  - 원 (circle)
  - 하트 (heart)
  - 별 (star)
  - 드래그로 크기 조절
- 자동 저장 기능
  - `SharedPreferences`로 임시 저장
  - 앱 종료/재시작 시 복구
  - 완료 시 자동 삭제
- 아키텍처 개선
  - `DrawingElement` 추상 클래스
  - `StrokeElement`, `ShapeElement`, `StickerElement` 구현
  - JSON 직렬화/역직렬화
- UI/UX 개선
  - 도구 아이콘 시각화
  - 스티커 팔레트 UI
  - 도형 미리보기 (드래그 중)

**수정 파일:**
```
🔧 전면 개편: lib/features/diary/views/drawing_canvas_page.dart
🔧 미세 조정: lib/features/diary/views/diary_write_page/diary_write_page.dart
```

**커밋 메시지 (복사용):**
```
feat: 그림 그리기 대폭 개선 (스티커 + 도형 + 자동저장)

- 감정 스티커 15개 추가 (😊😢😡😱😍 등)
- 도형 도구 3종 추가 (원/하트/별)
- 자동 저장 및 복구 기능
- DrawingElement 아키텍처 (추상 클래스)
- JSON 직렬화/역직렬화
- 도형 드래그 미리보기
- 감정 선택 UI 오버플로우 수정 (간격 18→22)

Improves: 그림 그리기 사용성 대폭 향상
Fixes: 바텀 오버플로우
```

**테스트 체크리스트:**
```
✅ 그림 그리기 페이지 진입
✅ 펜 도구로 자유 그리기
✅ 지우개로 지우기
✅ 원 도구로 드래그 (미리보기)
✅ 하트 도구로 드래그
✅ 별 도구로 드래그
✅ 스티커 버튼 → 15개 스티커 표시
✅ 스티커 선택 → 화면 중앙 배치
✅ 실행 취소/다시 실행
✅ 전체 지우기
✅ 완료 → 파일 저장
✅ 앱 종료 → 재시작 → 자동 복구 확인
✅ 감정 선택 UI 오버플로우 없음
```

**개선 효과:**
```
Before: 기본 그리기만 (⭐⭐⭐☆☆)
After:  스티커 + 도형 + 자동저장 (⭐⭐⭐⭐☆)

추가 기능:
1. ✅ 감정 스티커 (15개)
2. ✅ 도형 도구 (원/하트/별)
3. ✅ 자동 저장
4. ⭐ 사용자 경험 대폭 향상
```

**개선 효과:**
```
Before:
❌ 선택 시 이미지와 테두리 사이 흰색 공백
❌ 대표 캐릭터 주변 흰색 박스
❌ borderRadius 불일치로 어색함

After:
✅ 선택 시 공백 완전 제거
✅ 대표 캐릭터 이미지만 표시
✅ borderRadius 완벽 일치
✅ 배경 투명으로 깔끔함
```

**개선 효과:**
```
Before:
❌ 이미지 크기가 itemSize 계산으로 가변적
❌ padding으로 이미지와 박스 크기 불일치
❌ 세로 간격이 너무 넓음 (화면 높이 기준)
❌ 텍스트 크기도 화면 너비 기준 가변

After:
✅ 모든 이미지 75x75 통일
✅ 바깥 사각형과 이미지 크기 완전 동일
✅ 세로 간격 33% 줄임 (15px→10px)
✅ 모든 크기 고정으로 일관성 확보
```

**개선 효과:**
```
Before:
❌ 네모박스와 이미지 사이 빈 공간 어색
❌ padding 10px로 이미지 작게 표시
❌ 미선택 시에도 border 표시

After:
✅ 빈 공간 최소화 (padding 2-4px)
✅ 이미지가 박스를 거의 채움
✅ 미선택 시 border 없음 (깔끔)
✅ 선택 시 강한 테두리 + 그림자
```

**개선 효과:**
```
Before:
❌ 감정 캐릭터 머리 부분 잘림
❌ 선택 시 보라색 원 배경 (투박함)
❌ "asf" 같은 답변에도 공감

After:
✅ 캐릭터 온전히 표시 (둥근 사각형 + 패딩)
✅ 세련된 선택 효과 (border + 그림자)
✅ 이상한 답변은 다시 물어봄
```

---

## 📝 다음 작업 예정

1. 캐릭터별 AI 말투 차별화 (프롬프트 시스템 문서화)
2. 라우팅 버그 수정 (AI 채팅→상세 페이지)
3. 다크모드 색상 대비 개선
4. 감정 통계 대시보드 구현

